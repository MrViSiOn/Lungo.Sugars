LUNGO.Sugar.GMap=function(i){var j={sensor:false,mobile:true},f=null,a=[];return{init:function(b){var d=i.dom(b.el);if(d.length>0)f=this.Interface.Map(d[0],b);else console.error("Imposible")},image:function(b){var d=i.dom(b.el);if(d.length>0){b=i.Core.mix(j,b);var h=$$.environment();b.size=h.screen.width+"x"+h.screen.height;b.center=b.center.latitude+","+b.center.longitude;b.markers=b.center;delete b.el;b="http://maps.google.com/maps/api/staticmap"+$$.serializeParameters(b);d.html('<img src="'+b+
'"/>')}},instance:function(){return f},clean:function(){for(var b=0,d=a.length;b<d;b++)a[b].setMap(null);a=[];this.Route.clean()},center:function(b){f.setCenter(this.Interface.LatLng(b))},zoom:function(b){f.setZoom(b)},addMarker:function(b,d,h){if(b){var k=new google.maps.Marker({map:f,icon:this.Interface.MarkerIcon(d),animation:google.maps.Animation.DROP,position:this.Interface.LatLng(b)});h&&k.setAnimation(google.maps.Animation.BOUNCE);a.push(k)}return k}}}(LUNGO);LUNGO.Sugar.GMap.Interface=function(i){var j={ROADMAP:"roadmap",SATELLITE:"satellite",HYBRID:"hybrid",TERRAIN:"terrain"},f={zoom:12,disableDefaultUI:true,mapTypeId:j.ROADMAP};return{Map:function(a,b){if(b.type)b.mapTypeId=j[b.type];if(b.center)b.center=new google.maps.LatLng(b.center.latitude,b.center.longitude);return new google.maps.Map(a,i.Core.mix(f,b))},LatLng:function(a){return new google.maps.LatLng(a.latitude,a.longitude)},MarkerIcon:function(a){if(a)var b=new google.maps.MarkerImage(a.url,
new google.maps.Size(a.size.x,a.size.y),new google.maps.Point(0,0),new google.maps.Point(a.anchor.x,a.anchor.y));return b||null}}}(LUNGO);LUNGO.Sugar.GMap.Route=function(i,j){var f={WALKING:"WALKING",DRIVING:"DRIVING",BICYCLING:"BICYCLING"},a={service:null,directions:null,route:null,instructions:null,markers:{icons:[],pointers:[]}},b=LUNGO.Sugar.GMap,d=null,h=function(){if(a.renderer){a.renderer.setMap(null);for(var c=0,e=a.markers.pointers.length;c<e;c++)a.markers.pointers[c].setMap(null);a.markers.pointers=[]}},k=function(c,e,g){a.markers.icons=g;a.markers.from=c;a.markers.to=e},l=function(c,e){var g=b.addMarker(c,e||null);a.markers.pointers.push(g)};
return{init:function(c,e,g,n,o){d=o||null;k(c,e,n);a.route=null;a.instructions=null;a.service=a.service||new google.maps.DirectionsService;a.service.route({origin:b.Interface.LatLng(c),destination:b.Interface.LatLng(e),travelMode:g!==j?f[g]:f.DRIVING},function(m,p){if(p==google.maps.DirectionsStatus.OK){a.route=m;a.instructions=m.routes[0].legs[0];h();a.renderer=new google.maps.DirectionsRenderer({suppressMarkers:a.markers.icons?true:false});a.renderer.setMap(b.instance());a.renderer.setDirections(a.route);
if(a.markers.icons){l(a.markers.from,a.markers.icons.from);l(a.markers.to,a.markers.icons.to)}d&&d.apply(d)}})},clean:h,instructions:function(){var c={};if(a.instructions){c.distance=a.instructions.distance.text;c.duration=a.instructions.duration.text;var e=[];for(index in a.instructions.steps){var g=a.instructions.steps[index];e.push({distance:g.distance.text,duration:g.duration.text,instructions:g.instructions})}c.steps=e}return c}}}(LUNGO);
